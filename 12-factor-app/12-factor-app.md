The Twelve Factor App
======

1. コードベース
2. 依存関係
3. 設定
4. バックエンドサービス
5. ビルド、リリース、実行
6. プロセス
7. ポートバインディング
8. 並行性
9. 廃棄容易性
10. 開発/本番一致
11. ログ
12. 管理プロセス


## コードベース

バージョン管理されている１つのコードと複数のデプロイ

- １つのコードベースは複数のデプロイにマッピングされる
- アプリケーションごとにただ１つのコードベースが存在する
- アプリケーションのデプロイは複数存在する

## 依存関係

依存関係を明示的に宣言し分離する

- すべての依存関係を依存関係宣言マニフェストで完全かつ厳密に宣言する
- 実行時には依存関係分離ツールを使って、取り囲んでいるシステムから暗黙の依存関係が”漏れ出ないこと”を保証する
- 完全かつ明示的な依存関係の指定は、本番環境と開発環境の両方に対して同様に適用される

## 設定

設定を環境変数に格納する

- 設定をコードから厳密に分離する
  - 設定はデプロイごとに大きく異なるが、コードはそうではない
- 認証情報を漏洩させることなく、コードベースをオープンソースにできるかどうか？でテスト
- このときの”設定”の定義には、アプリケーション内部の設定は含まない

## バックエンドサービス

バックエンドサービスをアタッチされたリソースとして扱う

- ”バックエンドサービス”はアプリケーションが通常の動作の中でネットワーク経由で利用するすべてのサービスを言う
- ローカルサービスとサードパーティサービスを区別しない
- アタッチされたリソースとアタッチする対象のデプロイが疎結合であることを意味する

## ビルド、リリース、実行

ビルド、リリース、実行の３つのステージを厳密に分離する

- コードベースは３つのステージを経て、デプロイへと変換される
- リリース管理ツールを用いたリリースとロールバックの制御
- 実行ステージはできるだけ可変部分を持たないようにするべき

## プロセス

アプリケーションを１つもしくは複数の「内部状態を持たない（ステートレスな）プロセス」として実行する

- Twelve-Factorのプロセスはステートレスかつシェアードナッシング
- 永続化する必要のあるすべてのデータは、ステートフルなバックエンドサービスに格納する
- スティッキーセッションはTwelve-Factorに違反している

## ポートバインディング

ポートバインディングを通してサービスを公開する

- リクエストを処理するための実行環境との契約は、ポートをバインディングすることである
- ほぼすべてのサーバソフトウェアは、ポートをバインドするプロセスを用いて動作し、リクエストが来るのを待つ
- ポートバインディングの方法によって、あるアプリケーションが他のアプリケーションにとってのバックエンドサービスになれる

## 並行性

プロセスモデルによってスケールアウトする

- 個々のワークロードの種類をプロセスタイプに割り当てることで、開発者はアプリケーションが多様なワークロードを扱えるように設計することができる
- Twelve-Factor Appプロセスの性質は、平行性を高める操作が単純かつ確実なものであることを意味する
- プロセスタイプとそれぞれのタイプのプロセス数の配列は、プロセスフォーメーションと言われる

## 廃棄容易性

高速な起動とグレースフルシャットダウンで堅牢性を最大化する

- Twelve-Factor Appのプロセスは廃棄容易である、すなわち即座に起動・終了することができる
  - プロセスは、起動時間を最小化するよう努力すべき
- プロセスは、プロセスマネージャーからSIGTERMシグナルを受け取ったときに、グレースフルにシャットダウンする
- プロセスは突然の死に対して堅牢であるべき

## 開発/本番一致

開発、ステージング、本番環境をできるだけ一致させた状態を保つ

- 環境間のギャップが生まれがち（時間、人材、ツール）
- 継続的デプロイしやすいよう開発環境と本番環境のギャップを小さく保つ
- Twelve-Factorの開発者は、開発と本番の間で異なるバックエンドサービスを使いたくなる衝動に抵抗する

## ログ

ログをイベントストリームとして扱う

- ログは、すべての実行中のプロセスとバックエンドサービスの出力ストリームから収集されたイベントが、集約されて時刻順に並べられたストリームである
- Twelve-Factor Appはアプリケーションの出力ストリームの送り先やストレージについていっさい関知しない
- 実行中のプロセスはイベントストリームを標準出力にバッファリングせずに書き出す


## 管理プロセス

管理タスクを１回限りのプロセスとして実行する

- １回限りの管理プロセスは、アプリケーションの通常の長時間実行されるプロセスとまったく同じ環境で実行されるべき
- 同じ依存関係分離技術をすべてのプロセスタイプに利用するべき
- Twelve-Factorは細かい設定なしですぐに使えるREPLシェルを提供する言語を強く好む


